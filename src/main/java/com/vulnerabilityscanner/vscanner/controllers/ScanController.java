package com.vulnerabilityscanner.vscanner.controllers;

import com.vulnerabilityscanner.vscanner.entities.MachineScan;
import com.vulnerabilityscanner.vscanner.repositories.MachineScanRepository;
import com.vulnerabilityscanner.vscanner.services.NetworkScanService;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;

import java.util.List;

@Controller
public class ScanController {

    private final NetworkScanService networkScanService;
    private final MachineScanRepository machineScanRepository;

    public ScanController(NetworkScanService networkScanService, MachineScanRepository machineScanRepository) {
        this.networkScanService = networkScanService;
        this.machineScanRepository = machineScanRepository;
    }

    @GetMapping("/scan")
    public String scanNetwork(Model model) {
        networkScanService.scanNetworkAndSaveMachines(); // lance le scan
        List<MachineScan> machines = machineScanRepository.findAll();
        model.addAttribute("machines", machines);
        return "machines/machines_scan"; // Thymeleaf template scan.html
    }
}
