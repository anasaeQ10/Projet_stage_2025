<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/base}" lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Tableau de bord - Statistiques Avancées</title>

    <!-- CSS critiques en inline -->
    <style>
        :root {
            --admin-color: #dc3545;
            --normal-color: #28a745;
            --machine-color: #007bff;
            --vuln-color: #fd7e14;
            --gradient-bg: linear-gradient(90deg, #007bff, #6610f2);
            --gradient-danger: linear-gradient(90deg, #dc3545, #c82333);
            --gradient-success: linear-gradient(90deg, #28a745, #20c997);
            --gradient-warning: linear-gradient(90deg, #fd7e14, #ffc107);
        }

        .dashboard-header {
            background: var(--gradient-bg);
            color: white;
            border-radius: 12px;
            padding: 20px 30px;
            margin-bottom: 30px;
            box-shadow: 0 6px 15px rgba(0,0,0,0.15);
        }

        .stat-card {
            border-radius: 16px;
            border: none;
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(6px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            transition: all 0.3s ease-in-out;
            height: 100%;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-value {
            font-size: 2.2rem;
            font-weight: 700;
        }

        /* Styles pour l'affichage initial */
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .stat-icon {
            font-size: 2.8rem;
            opacity: 0.15;
        }

        .card-header {
            background: transparent;
            border: none;
            font-weight: 600;
            font-size: 1.1rem;
            padding: 15px 20px;
        }

        .card {
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }

        table thead {
            background: var(--gradient-bg);
            color: white;
        }

        table tbody tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        .badge {
            font-size: 0.85rem;
            padding: 6px 12px;
        }

        .severity-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
        }

        .severity-secure {
            background-color: rgba(40, 167, 69, 0.15);
            color: #28a745;
        }

        .severity-check {
            background-color: rgba(253, 126, 20, 0.15);
            color: #fd7e14;
        }

        .severity-verify {
            background-color: rgba(255, 193, 7, 0.15);
            color: #ffc107;
        }

        .severity-danger {
            background-color: rgba(220, 53, 69, 0.15);
            color: #dc3545;
        }

        .progress {
            height: 10px;
            border-radius: 5px;
        }

        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }

        .nav-tabs .nav-link {
            border: none;
            border-bottom: 3px solid transparent;
            color: #6c757d;
            font-weight: 500;
            padding: 12px 20px;
        }

        .nav-tabs .nav-link.active {
            border-bottom: 3px solid #007bff;
            color: #007bff;
            background: transparent;
        }

        .filter-section {
            background-color: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .stat-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
    </style>

    <!-- Chargement asynchrone des ressources -->
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"></noscript>

    <link rel="preload" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"></noscript>

    <!-- Chargement différé des scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0" defer></script>
</head>
<body>
<div class="container-fluid py-4" layout:fragment="content">

    <!-- Header -->
    <div class="dashboard-header d-flex justify-content-between align-items-center">
        <div>
            <h2 class="mb-1"><i class="bi bi-graph-up-arrow me-2"></i>Tableau de bord avancé</h2>
            <p class="mb-0 opacity-75">Vue d'ensemble complète de votre parc informatique et des vulnérabilités</p>
        </div>
        <span class="badge bg-light text-dark fs-6"><i class="bi bi-shield-lock me-1"></i>Espace Admin</span>
    </div>

    <!-- Filtres -->
    <div class="filter-section mb-4">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h5 class="mb-3">Filtres</h5>
                <div class="d-flex flex-wrap gap-3">
                    <div>
                        <label class="form-label small mb-1">Période</label>
                        <select class="form-select form-select-sm" style="width: 180px;">
                            <option>30 derniers jours</option>
                            <option>3 derniers mois</option>
                            <option>6 derniers mois</option>
                            <option selected>Cette année</option>
                            <option>Tout</option>
                        </select>
                    </div>
                    <div>
                        <label class="form-label small mb-1">Type de machine</label>
                        <select class="form-select form-select-sm" style="width: 150px;">
                            <option>Tous</option>
                            <option th:each="type : ${machineTypes}" th:text="${type}">Type</option>
                        </select>
                    </div>
                    <div>
                        <label class="form-label small mb-1">Sévérité</label>
                        <select class="form-select form-select-sm" style="width: 150px;">
                            <option>Tous</option>
                            <option>Securisé</option>
                            <option>À vérifier</option>
                            <option>Vérifier</option>
                            <option>Très dangereux</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="col-md-4 text-end">
                <button class="btn btn-outline-primary me-2"><i class="bi bi-download me-1"></i> Exporter</button>
                <button class="btn btn-primary"><i class="bi bi-arrow-clockwise me-1"></i> Actualiser</button>
            </div>
        </div>
    </div>

    <!-- Statistiques globales -->
    <div class="stats-grid">
        <div class="card stat-card">
            <div class="card-body d-flex justify-content-between align-items-center">
                <div>
                    <h6 class="text-muted small">Total Machines</h6>
                    <h2 class="stat-value text-primary" th:text="${totalMachines}">0</h2>
                    <div class="small text-muted">
                        <span th:class="${machineGrowth ge 0} ? 'text-success' : 'text-danger'">
                            <i th:class="${machineGrowth ge 0} ? 'bi bi-arrow-up-right' : 'bi bi-arrow-down-right'"></i>
                            <span th:text="${machineGrowth} + '%'">0%</span> vs mois dernier
                        </span>
                    </div>
                </div>
                <i class="bi bi-hdd-stack text-primary stat-icon"></i>
            </div>
        </div>

        <div class="card stat-card">
            <div class="card-body d-flex justify-content-between align-items-center">
                <div>
                    <h6 class="text-muted small">Machines Vulnérables</h6>
                    <h2 class="stat-value text-danger" th:text="${vulnerableMachinesCount}">0</h2>
                    <div class="small text-muted">
                        <span th:text="${vulnerablePercentage} + '% du parc'">0% du parc</span>
                    </div>
                </div>
                <i class="bi bi-exclamation-triangle text-danger stat-icon"></i>
            </div>
        </div>

        <div class="card stat-card">
            <div class="card-body d-flex justify-content-between align-items-center">
                <div>
                    <h6 class="text-muted small">Total Utilisateurs</h6>
                    <h2 class="stat-value text-primary" th:text="${totalUsers}">0</h2>
                    <div class="small text-muted">
                        <span th:text="${adminsCount} + ' admins'">0 admins</span>,
                        <span th:text="${normalUsersCount} + ' utilisateurs'">0 utilisateurs</span>
                    </div>
                </div>
                <i class="bi bi-people-fill text-primary stat-icon"></i>
            </div>
        </div>

        <div class="card stat-card">
            <div class="card-body d-flex justify-content-between align-items-center">
                <div>
                    <h6 class="text-muted small">Score CVE Moyen</h6>
                    <h2 class="stat-value text-warning" th:text="${#numbers.formatDecimal(avgCveScore, 1, 1)}">0.0</h2>
                    <div class="small text-muted">
                        <span th:if="${avgCveScore lt 4}" class="text-success">Faible risque</span>
                        <span th:if="${avgCveScore ge 4 and avgCveScore lt 7}" class="text-warning">Risque modéré</span>
                        <span th:if="${avgCveScore ge 7}" class="text-danger">Risque élevé</span>
                    </div>
                </div>
                <i class="bi bi-clipboard-data text-warning stat-icon"></i>
            </div>
        </div>
    </div>

    <!-- Graphiques principaux -->
    <div class="row g-4 mb-4">
        <div class="col-lg-8">
            <div class="card h-100">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <div><i class="bi bi-bar-chart-fill me-2 text-primary"></i>Évolution des vulnérabilités par mois</div>
                    <div class="btn-group btn-group-sm" role="group">
                        <button type="button" class="btn btn-outline-primary active">Mois</button>
                        <button type="button" class="btn btn-outline-primary">Trimestre</button>
                        <button type="button" class="btn btn-outline-primary">Année</button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="vulnerabilitiesTrendChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="card h-100">
                <div class="card-header"><i class="bi bi-pie-chart-fill me-2 text-primary"></i>Répartition par sévérité</div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="severityDistributionChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tableaux détaillés -->
    <ul class="nav nav-tabs mb-3" id="dashboardTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="machines-tab" data-bs-toggle="tab" data-bs-target="#machines" type="button" role="tab">Machines</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="vulnerabilities-tab" data-bs-toggle="tab" data-bs-target="#vulnerabilities" type="button" role="tab">Vulnérabilités</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="users-tab" data-bs-toggle="tab" data-bs-target="#users" type="button" role="tab">Utilisateurs</button>
        </li>
    </ul>

    <div class="tab-content" id="dashboardTabContent">
        <!-- Tab Machines -->
        <div class="tab-pane fade show active" id="machines" role="tabpanel">
            <div class="row">
                <div class="col-md-5">
                    <div class="card mb-4">
                        <div class="card-header"><i class="bi bi-hdd-network me-2 text-primary"></i>Répartition par type</div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="machinesByTypeChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-7">
                    <div class="card mb-4">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <div><i class="bi bi-list-check me-2 text-primary"></i>Détail des machines</div>
                            <input type="text" class="form-control form-control-sm" placeholder="Rechercher..." style="width: 200px;">
                        </div>
                        <div class="card-body">
                            <div class="table-responsive" style="max-height: 350px;">
                                <table class="table table-hover align-middle">
                                    <thead>
                                    <tr>
                                        <th>Nom</th>
                                        <th>Type</th>
                                        <th>OS</th>
                                        <th>Score CVE</th>
                                        <th>État</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr th:each="machine : ${machines}">
                                        <td th:text="${machine.name}">Machine</td>
                                        <td th:text="${machine.type}">Type</td>
                                        <td th:text="${machine.operatingSystem}">OS</td>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                    <span th:text="${#numbers.formatDecimal(machine.cveScore, 1, 1)}"
                                                          th:class="${machine.cveScore lt 4} ? 'text-success' :
                ${machine.cveScore lt 7} ? 'text-warning' : 'text-danger'">
    0.0
</span>

                                                <div class="progress ms-2 flex-grow-1" style="width: 60px; height: 6px;">
                                                    <div class="progress-bar"
                                                         th:class="${machine.cveScore lt 4} ? 'bg-success' :
                   ${machine.cveScore lt 7} ? 'bg-warning' : 'bg-danger'"
                                                         th:attr="style='width: ' + ${machine.cveScore * 10} + '%;'"
                                                         role="progressbar">
                                                    </div>
                                                </div>

                                            </div>
                                        </td>
                                        <td>
                                                <span th:switch="${machine.getSeverityLabel()}">
                                                    <span th:case="'Securisé'" class="severity-badge severity-secure">Sécurisé</span>
                                                    <span th:case="'À vérifier'" class="severity-badge severity-check">À vérifier</span>
                                                    <span th:case="'Vérifier'" class="severity-badge severity-verify">Vérifier</span>
                                                    <span th:case="'Très dangereux'" class="severity-badge severity-danger">Dangereux</span>
                                                </span>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab Vulnérabilités -->
        <div class="tab-pane fade" id="vulnerabilities" role="tabpanel">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <div><i class="bi bi-exclamation-triangle-fill me-2 text-warning"></i>Vulnérabilités détectées</div>
                    <div class="small text-muted">Total: <span th:text="${totalVulnerabilities}">0</span> vulnérabilités</div>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle">
                            <thead>
                            <tr>
                                <th>ID CVE</th>
                                <th>Machine</th>
                                <th>Score</th>
                                <th>Type</th>
                                <th>Description</th>
                                <th>Actions</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="vuln : ${recentVulnerabilities}"
                                th:class="${vuln.machine.cveScore ge 7} ? 'table-danger' :
              ${vuln.machine.cveScore ge 4} ? 'table-warning' : ''">

                            <td>
                                    <a href="#" th:text="${vuln.cveId}">CVE-XXXX-XXXX</a>
                                </td>
                                <td th:text="${vuln.machine.name}">Machine</td>
                                <td>
                                        <span th:class="${vuln.machine.cveScore lt 4} ? 'badge bg-success' :
                ${vuln.machine.cveScore lt 7} ? 'badge bg-warning' : 'badge bg-danger'"
                                              th:text="${#numbers.formatDecimal(vuln.machine.cveScore, 1, 1)}">
    0.0
</span>

                                </td>
                                <td th:text="${vuln.machine.cveCause}">Type</td>
                                <td>
                                    <div class="text-truncate" style="max-width: 250px;" th:text="${vuln.description}">
                                        Description de la vulnérabilité...
                                    </div>
                                </td>
                                <td>
                                    <button class="btn btn-sm btn-outline-primary"><i class="bi bi-eye"></i></button>
                                    <button class="btn btn-sm btn-outline-danger"><i class="bi bi-trash"></i></button>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab Utilisateurs -->
        <div class="tab-pane fade" id="users" role="tabpanel">
            <div class="row">
                <div class="col-md-6">
                    <div class="card mb-4">
                        <div class="card-header"><i class="bi bi-people-fill me-2 text-primary"></i>Répartition des utilisateurs</div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="usersDistributionChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card mb-4">
                        <div class="card-header"><i class="bi bi-calendar-event me-2 text-primary"></i>Utilisateurs par mois</div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="usersByMonthChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <div><i class="bi bi-person-lines-fill me-2 text-primary"></i>Derniers utilisateurs ajoutés</div>
                    <a href="#" class="btn btn-sm btn-outline-primary">Voir tout</a>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle">
                            <thead>
                            <tr>
                                <th>Nom</th>
                                <th>Email</th>
                                <th>Rôle</th>
                                <th>Date d'embauche</th>
                                <th>Entreprise</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="user : ${recentUsers}">
                                <td th:text="${user.nom + ' ' + user.prenom}">Nom Prénom</td>
                                <td th:text="${user.email}">email@example.com</td>
                                <td>
                                    <span th:if="${user.role eq 'ROLE_ADMIN'}" class="badge bg-danger">Admin</span>
                                    <span th:if="${user.role eq 'ROLE_USER'}" class="badge bg-success">Utilisateur</span>
                                </td>
                                <td th:text="${#temporals.format(user.dateEmbauche, 'dd/MM/yyyy')}">01/01/2023</td>
                                <td th:text="${user.entreprise != null} ? ${user.entreprise.name} : 'Non assigné'">Entreprise</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<!-- Données dynamiques pour Chart.js -->
<script th:inline="javascript">
    /*<![CDATA[*/
    // Données pour les graphiques
    const vulnerabilitiesByMonthLabels = /*[[${vulnerabilitiesByMonth.keySet()}]]*/ ['Jan','Fév','Mar','Avr','Mai','Juin','Juil','Août','Sept','Oct','Nov','Déc'];
    const vulnerabilitiesByMonthData = /*[[${vulnerabilitiesByMonth.values()}]]*/ [5,10,8,12,15,18,20,25,22,19,15,12];

    const severityDistributionLabels = /*[[${severityDistribution.keySet()}]]*/ ['Sécurisé', 'À vérifier', 'Vérifier', 'Très dangereux'];
    const severityDistributionData = /*[[${severityDistribution.values()}]]*/ [25, 15, 8, 5];
    const severityDistributionColors = ['#28a745', '#fd7e14', '#ffc107', '#dc3545'];

    const machinesByTypeLabels = /*[[${machinesByType.keySet()}]]*/ ['Serveur', 'Poste de travail', 'Ordinateur portable', 'Mobile'];
    const machinesByTypeData = /*[[${machinesByType.values()}]]*/ [12, 25, 18, 10];

    const usersDistributionLabels = ['Administrateurs', 'Utilisateurs'];
    const usersDistributionData = /*[[${[adminsCount, normalUsersCount]}]]*/ [5, 35];
    const usersDistributionColors = ['#dc3545', '#28a745'];

    const usersByMonthLabels = /*[[${usersByMonth.keySet()}]]*/ ['Jan','Fév','Mar','Avr','Mai','Juin','Juil','Août','Sept','Oct','Nov','Déc'];
    const usersByMonthData = /*[[${usersByMonth.values()}]]*/ [2,5,3,7,4,6,8,5,3,4,2,1];
    /*]]>*/
</script>

<!-- Initialisation Chart.js - Chargement différé -->
<script>
    function initCharts() {
        // Enregistrer le plugin datalabels
        if (typeof ChartDataLabels !== 'undefined') {
            Chart.register(ChartDataLabels);
        }

        // Graphique d'évolution des vulnérabilités
        const vulnTrendCtx = document.getElementById('vulnerabilitiesTrendChart');
        if (vulnTrendCtx) {
            new Chart(vulnTrendCtx, {
                type: 'line',
                data: {
                    labels: vulnerabilitiesByMonthLabels,
                    datasets: [{
                        label: 'Vulnérabilités détectées',
                        data: vulnerabilitiesByMonthData,
                        backgroundColor: 'rgba(220, 53, 69, 0.1)',
                        borderColor: '#dc3545',
                        borderWidth: 2,
                        tension: 0.3,
                        fill: true,
                        pointBackgroundColor: '#dc3545',
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 5
                            }
                        }
                    }
                }
            });
        }

        // Graphique de répartition par sévérité
        const severityCtx = document.getElementById('severityDistributionChart');
        if (severityCtx) {
            new Chart(severityCtx, {
                type: 'doughnut',
                data: {
                    labels: severityDistributionLabels,
                    datasets: [{
                        data: severityDistributionData,
                        backgroundColor: severityDistributionColors,
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        },
                        datalabels: {
                            color: '#fff',
                            font: {
                                weight: 'bold',
                                size: 11
                            },
                            formatter: (value) => value
                        }
                    }
                }
            });
        }

        // Graphique machines par type
        const machinesTypeCtx = document.getElementById('machinesByTypeChart');
        if (machinesTypeCtx) {
            new Chart(machinesTypeCtx, {
                type: 'pie',
                data: {
                    labels: machinesByTypeLabels,
                    datasets: [{
                        data: machinesByTypeData,
                        backgroundColor: ['#007bff', '#6610f2', '#6f42c1', '#e83e8c']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // Graphique répartition utilisateurs
        const usersDistCtx = document.getElementById('usersDistributionChart');
        if (usersDistCtx) {
            new Chart(usersDistCtx, {
                type: 'doughnut',
                data: {
                    labels: usersDistributionLabels,
                    datasets: [{
                        data: usersDistributionData,
                        backgroundColor: usersDistributionColors
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        },
                        datalabels: {
                            color: '#fff',
                            font: {
                                weight: 'bold'
                            },
                            formatter: (value) => value
                        }
                    }
                }
            });
        }

        // Graphique utilisateurs par mois
        const usersMonthCtx = document.getElementById('usersByMonthChart');
        if (usersMonthCtx) {
            new Chart(usersMonthCtx, {
                type: 'bar',
                data: {
                    labels: usersByMonthLabels,
                    datasets: [{
                        label: 'Nouveaux utilisateurs',
                        data: usersByMonthData,
                        backgroundColor: 'rgba(0,123,255,0.8)',
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }
    }

    // Initialiser les graphiques lorsque la page est chargée
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initCharts);
    } else {
        initCharts();
    }
</script>

<!-- Bootstrap JS - Chargement différé -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" defer></script>

</body>
</html>